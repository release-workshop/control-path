#!/bin/bash
# Commit message validation hook
# Validates Conventional Commits format

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Conventional Commits pattern: type(scope): description
# Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
# Optional scope in parentheses
# Description starts after colon and space

pattern='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .+'

if ! echo "$commit_msg" | head -n 1 | grep -qE "$pattern"; then
  echo "‚ùå Invalid commit message format!"
  echo ""
  echo "Commit messages must follow Conventional Commits format:"
  echo "  type(scope): description"
  echo ""
  echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
  echo "Scopes: compiler, cli, runtime, repo, ci, docs, deps (optional)"
  echo ""
  echo "Examples:"
  echo "  feat(compiler): add support for semver comparison"
  echo "  fix(cli): handle missing flag definitions gracefully"
  echo "  chore(ci): update GitHub Actions workflows"
  echo ""
  echo "Your message:"
  echo "  $(echo "$commit_msg" | head -n 1)"
  exit 1
fi

exit 0

