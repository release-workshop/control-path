{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://controlpath.dev/schemas/override-file.schema.v1.json",
  "title": "Control Path Override File Schema",
  "description": "Schema for runtime flag override files (kill switches). Supports both simple and full formats for emergency and audit use cases.",
  "type": "object",
  "required": ["version", "overrides"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Override file format version (e.g., '1.0')",
      "pattern": "^\\d+\\.\\d+$"
    },
    "overrides": {
      "type": "object",
      "description": "Map of flag names to override values. Supports both simple string values and full override objects.",
      "additionalProperties": {
        "oneOf": [
          {
            "type": "string",
            "description": "Simple format: direct value (e.g., 'ON', 'OFF', 'V1', 'V2'). For boolean flags: 'ON' or 'OFF'. For multivariate flags: variation name (e.g., 'V1', 'V2', 'PRIMARY')."
          },
          {
            "type": "object",
            "description": "Full format: override object with value and optional metadata for audit trail.",
            "required": ["value"],
            "properties": {
              "value": {
                "type": "string",
                "description": "Override value. For boolean flags: 'ON' or 'OFF'. For multivariate flags: variation name (e.g., 'V1', 'V2', 'PRIMARY')."
              },
              "timestamp": {
                "type": "string",
                "format": "date-time",
                "description": "ISO 8601 timestamp when override was set (optional, auto-generated by CLI if not provided)"
              },
              "reason": {
                "type": "string",
                "description": "Reason for override (optional, recommended for audit trail)"
              },
              "operator": {
                "type": "string",
                "description": "Operator who set the override (optional, recommended for audit trail, e.g., email, username)"
              }
            },
            "additionalProperties": false
          }
        ]
      }
    }
  },
  "additionalProperties": false
}
