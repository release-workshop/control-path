
# Pre-commit hook: Run checks before commit is created
# Note: Commit message validation happens in commit-msg hook

# Check if there are staged changes
if git diff --cached --quiet; then
  echo "No staged changes to commit."
  exit 0
fi

echo "Verifying build and performing code checks..."

# Ensure we're in the repo root
cd "$(git rev-parse --show-toplevel)" || exit 1

# TypeScript/JavaScript checks
echo "üì¶ Checking TypeScript runtime SDK..."
cd runtime/typescript && pnpm build || {
  echo "‚ùå TypeScript build check failed."
  exit 1
}
cd ../..

# Rust checks
echo "ü¶Ä Checking Rust crates..."

# Check if cargo is available
if ! command -v cargo &> /dev/null; then
  echo "‚ö†Ô∏è  Warning: cargo not found. Skipping Rust checks."
else
  # Check compilation
  echo "  Running cargo check..."
  cargo check --workspace || {
    echo "‚ùå Rust check failed."
    exit 1
  }

  # Run tests
  echo "  Running cargo test..."
  cargo test --workspace || {
    echo "‚ùå Rust tests failed."
    exit 1
  }

  # Build crates
  echo "  Running cargo build..."
  cargo build --workspace || {
    echo "‚ùå Rust build failed."
    exit 1
  }
fi

# Reminder about commit message format (actual validation happens in commit-msg hook)
echo "üí° Remember: Use Conventional Commits format (e.g., 'feat(scope): description')"
echo "   Commit message will be validated by commitlint in commit-msg hook."

exit 0

